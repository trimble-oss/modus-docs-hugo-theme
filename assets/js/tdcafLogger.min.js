!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tdcafLogger=e():t.tdcafLogger=e()}(window,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"sendEvent",(function(){return dt})),n.d(e,"init",(function(){return ft})),n.d(e,"getSessionId",(function(){return ht})),n.d(e,"setGlobalAttributes",(function(){return gt})),n.d(e,"trackEvents",(function(){return mt})),n.d(e,"logNPSScore",(function(){return vt})),n.d(e,"toggleNPSWindow",(function(){return yt})),n.d(e,"toggleRuleBasedNPSWindow",(function(){return wt})),n.d(e,"getUsersEventCount",(function(){return _t})),n.d(e,"setUserIdForSession",(function(){return bt})),n.d(e,"DisplayDialogEvent",(function(){return h})),n.d(e,"CloseDialogEvent",(function(){return g})),n.d(e,"BaseEvent",(function(){return c})),n.d(e,"ClickEvent",(function(){return s})),n.d(e,"DeviceInfoEvent",(function(){return Y})),n.d(e,"PageViewEvent",(function(){return M})),n.d(e,"SessionEndEvent",(function(){return J})),n.d(e,"SessionStartEvent",(function(){return U}));var o={};function r(t){o={...o,...t}}var i,a=function(){return(a=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},c=function(){function t(t,e,n){this.event=t,this.group=e,this.props=n,this.sessionId=ot(),this.timestamp=+new Date}return t.prototype.toString=function(){return JSON.stringify(a({event:this.event,group:this.group,sessionId:this.sessionId,timestamp:this.timestamp},this.props))},t.prototype.toLoggableObject=function(){return a({event:this.event,group:this.group,sessionId:this.sessionId,timestamp:this.timestamp},this.props)},t}(),u=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){function e(e){var n=t.call(this,"CLICK","USER_ACTIVITY",e)||this;return n.props=e,n}return u(e,t),e}(c),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),p=function(t){function e(e){var n=t.call(this,"USER_RESPONSE","NPS_SURVEY",e)||this;return n.props=e,n}return l(e,t),e}(c),d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(t){function e(e){var n=t.call(this,"USER_FEEDBACK","NPS_SURVEY",e)||this;return n.props=e,n}return d(e,t),e}(c),h=function(){},g=function(){},m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(t){function e(e){var n=t.call(this,"NPS_DIALOG_DISPLAY","NPS_SURVEY",e)||this;return n.props=e,n}return m(e,t),e}(c),y=function(t){function e(e){var n=t.call(this,"NPS_DIALOG_CLOSE","NPS_SURVEY",e)||this;return n.props=e,n}return m(e,t),e}(c),w=function(){function t(){}return t.prototype.displayDialog=function(t){return T(new v({feature:t.feature,eventCount:t.eventCount}))},t.prototype.closeDialog=function(t){return T(new y({feature:t.feature}))},t}();const _="https://api-insights.trimble.com";var b="";function E(){return b}var S="",O={},x=new Map,I=new Map,P=new w;function j(){let t=document.getElementById("modal_id");t&&t.remove();let e=new g;e.feature=S,P.closeDialog(e)}function L(t,e){return T(new p({npsSurveyScore:t,...e}))}function N(t,e,n,o){S=o;var r=document.createElement("link");(r.rel = "stylesheet"), (r.href = "https://modus.trimble.com/css/modus.min.css"), document.getElementsByTagName("head")[0].appendChild(r);var i=document.createElement("style");i.type="text/css",i.innerHTML='.modal-container { position: absolute;\n        background: rgb(rgb(151, 149, 149), green, blue);\n        padding: 20px;\n        bottom: 0;\n        right: 0;\n        z-index: 10040;\n        overflow: auto;\n        overflow-y: auto;\n        box-shadow: gray 10px 10px 10px 10px; }\n        .mostLikely {\n            margin-top: "4px";\n            float: right;\n        }\n        .notLikely {\n            margin-top: "4px";\n            float: left;\n        }\n        .hideDiv {\n            display:none\n        }\n        .showDiv {\n            display: block\n        }\n        .feedbackBox {\n            height: 70px;\n            width: 400px;\n        }\n        .submitButton {\n            margin-top: 4px;\n        }\n        ',document.getElementsByTagName("head")[0].appendChild(i);var a=document.getElementById("root"),c=document.createElement("div");c.classList.add("modal"),c.classList.add("d-block"),c.setAttribute("role","dialog"),c.setAttribute("id","modal_id");var u=document.createElement("div");u.classList.add("modal-container");var s=document.createElement("button");s.type="button",s.innerHTML="x",s.classList.add("close"),s.setAttribute("data-dismiss","modal"),s.onclick=j,u.append(s);var l=document.createElement("div"),p=document.createElement("p");p.textContent+=t||"How likely are you to recommend us to a friend or colleague?",l.append(p);var d=document.createElement("div");d.classList.add("hideDiv");var g=document.createElement("p");g.textContent+="Any other suggestions?",d.append(g);var m=document.createElement("input");m.type="text",m.id="feedbackInput",m.classList.add("feedbackBox"),d.append(m);var v=document.createElement("div"),y=document.createElement("button");y.classList.add("submitButton"),y.type="button",y.innerText="Submit",y.classList.add("btn"),y.classList.add("btn-primary"),y.onclick=function(t){!function(t,e){T(new f({npsSurveyFeedback:t,...e}))}(document.getElementById("feedbackInput").value,{feature:o}),j()},v.append(y),d.append(v);for(let t=1;t<=10;t++){let e=document.createElement("button");e.type="button",e.id="button"+t,e.classList.add("btn"),e.classList.add("btn-primary"),e.classList.add("btn-sm"),e.classList.add("m-1"),e.innerText=t,e.onclick=function(t){l.classList.add("hideDiv"),d.classList.add("showDiv"),L(t.target.innerText,{feature:o})},l.append(e)}let w=document.createElement("div");var _=document.createElement("p");_.textContent+=e||"Not likely",_.classList.add("notLikely"),w.append(_);var b=document.createElement("p");b.textContent+=n||"Most likely",b.classList.add("mostLikely"),w.append(b),l.appendChild(w),u.append(l),u.append(d),c.appendChild(u),a.appendChild(c);let E=new h;E.feature=o,E.eventCount=x.get(o),P.displayDialog(E)}function k(t,e,n){let o=e-t%e;return x.get(n)-t>=o}function C(t){O=t.nps;for(const[t,e]of Object.entries(O)){let t=x.get(e.eventName);t?x.set(e.eventName,t+parseInt(e.eventCount)):x.set(e.eventName,parseInt(e.eventCount)),D()}}function D(){let t={};for(const[e,n]of Object.entries(O)){let o=x.get(n.eventName)?x.get(n.eventName):n.eventCount;if("once every"===n.ruleCondition)if("count"==n.ruleType)o%n.triggerPoint==0||k(n.survey.displayedAt,n.triggerPoint,e)?t.showNPSDialog=!0:t.showNPSDialog=!1;else if("duration"==n.ruleType){const e=new Date(n.survey.lastDisplayed),o=new Date,r=Math.abs(o-e),i=Math.ceil(r/864e5);let a=n.triggerPoint.split("D")[0];t.showNPSDialog=i>=a}I.set(n.eventName,t.showNPSDialog)}}async function A(){try{C(await async function(){try{let t=E();if(t){let e="/configuration?config=nps&uid="+t,n=await fetch(_+e,{keepalive:!0,method:"GET",headers:{"x-api-key":st(),"x-app-name":lt()}});return await n.json()}return console.log("Global uid is not set"),null}catch(t){console.log("Error occured while fetching user event count",t)}}())}catch(t){console.log("Error occured while fetching user event count",t)}}var T=function(t){ut(t.toLoggableObject()),pt()&&function(t){if(x){let e=1;x.has(t)&&(e=parseInt(x.get(t))+1),x.set(t,e)}}(t.event)},V=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),U=function(t){function e(e){var n=t.call(this,"SESSION_START","SESSION",e)||this;return n.props=e,n}return V(e,t),e}(c),B={url:_+"/datalogger",method:"POST",headers:{},timeout:0,interval:12e4,isNPSEnabled:!1,level:"trace",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:2e3,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:()=>(new Date).toISOString(),format:remote.json},R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),M=function(t){function e(e){var n=t.call(this,"PAGE_VISIT","USER_ACTIVITY",e)||this;return n.props=e,n}return R(e,t),e}(c),G=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Y=function(t){function e(e){var n=t.call(this,"DEVICE_INFO","DEVICE",e)||this;return n.props=e,n}return G(e,t),e}(c),F=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(e){var n=t.call(this,"SESSION_END","SESSION",e)||this;return n.props=e,n}return F(e,t),e}(c),H=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),K=function(t){function e(e){var n=t.call(this,"USER_LOCATION","USER",e)||this;return n.props=e,n}return H(e,t),e}(c),W={pageVisits:!0,location:!0,deviceInfo:!0,clicks:!0};function q(){var t;tt(),pt()&&A().then(()=>{console.log("evaluation of nps snapshot done")}),W.pageVisits&&T(new M({pageVisited:window.location.pathname})),W.location&&(console.log("add location"),fetch(_+"/deviceinfo",{keepalive:!0,method:"GET",headers:{"x-api-key":st()}}).then((function(t){t.json().then((function(t){T(new K({ip_address:t.body.clientIp}))}))})).catch((function(t){return console.log("err during location fetch:",t)}))),window.addEventListener("unload",z),W.clicks&&(document.onreadystatechange=()=>{"complete"===document.readyState&&X()}),W.pageVisits&&(history.pushState=(t=history.pushState,function(){var e=t.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),e}),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))}),window.addEventListener("locationchange",(function(){T(new M({pageVisited:window.location.pathname})),setTimeout((function(){W.clicks&&X()}),100)})))}function z(t){if(!nt)return;let e=+new Date,n=remote.getQueueContent()||[],o=[];if(n.forEach(t=>{o=[...o,JSON.parse(t)]}),W.deviceInfo){let t={message:new Y({width:window.screen.width,height:window.screen.height,platform:window.navigator.platform,userAgent:window.navigator.userAgent,sessionId:ot(),timestamp:e}).toString()};o=[...o,t]}let r={message:(new J).toString()};o=[...o,r];const i=fetch(B.url,{keepalive:!0,method:"POST",headers:{"Content-Type":"application/json",...B.headers},body:JSON.stringify({logs:o})}).then(t=>console.log("res :",t)).catch(t=>console.log("err :",t));console.log("request",i)}function Q(){var t,e=0;function n(){e=0}document.onclick=n,document.onmousemove=n,document.onkeypress=n,t=window.setInterval((function(){(e+=60)>=1800&&(window.clearInterval(t),z(),et=null,nt=!1)}),6e4)}function X(){Z(document.getElementsByTagName("a"),"click",$),Z(document.getElementsByTagName("button"),"click",$)}function Z(t,e,n){for(var o=0;o<t.length;o++)t[o].addEventListener(e,n)}function $(){var t={type:"click",location:window.location.href,pathname:window.location.pathname,hash:window.location.hash,referer:document.referrer,language:window.navigator.userLanguage||window.navigator.language,width:screen.width,height:screen.height,platform:window.navigator.platform,userAgent:window.navigator.userAgent,local_time:new Date};t.destination=this.getAttribute("href"),t.name=this.getAttribute("name"),t.id=this.getAttribute("id"),t.displayText=this.innerText,t.event="CLICK",t.group="USER_ACTIVITY",t.event=t.type.toUpperCase(),T(new s(t))}function tt(){!function(){nt=!0;var t=(new Date).getTime();et="xxyxxxyxxxxxxxxy".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)}))}(),T(new U),Q()}var et=null,nt=!1;function ot(){return et||tt(),et}var rt=null,it=null,at=null,ct=!1;const ut=t=>{t.sessionId||(t.sessionId=ot()),t.timestamp||(t.timestamp=+new Date),t={...t,...o},rt.info(""+JSON.stringify(t))},st=()=>it,lt=()=>at,pt=()=>ct;function dt(t){return T(t)}function ft(t){return(t=>{console.log("Inside initLogger"),console.log(JSON.stringify(t)),B.url=t.url?t.url:B.url,B.interval=t.interval?t.interval:B.interval,B.headers=t.headers?t.headers:B.headers,ct=!!t.isNpsEnabled&&t.isNpsEnabled,remote.apply(log,B),(rt=log.getLogger(t.appName||"TDCAF")).enableAll(),it=B.headers["x-api-key"],at=B.headers["x-app-name"],Object.assign(W,t.trackEvents)})(t)}function ht(){return ot()}function gt(t){return r(t)}function mt(){return q()}function vt(t,e){return L(t,e)}function yt(t,e,n,o){return N(t,e,n,o)}function wt(t,e,n,o){return function(t,e,n,o){if(D(),pt()&&!0===I.get(o))return N(t,e,n,o)}(t,e,n,o)}function _t(){return async function(){try{let t=E();if(t){let e=await fetch(_+"/usereventcount",{keepalive:!0,method:"GET",headers:{"x-api-key":st(),"x-app-name":lt(),"x-uid":t}});return await e.json()}return console.log("Global uid is not set"),null}catch(t){console.log("Error occured while fetching user event count",t)}}()}function bt(t){return function(t){b=t;let e={};e.insightsUid=b,r(e)}(t)}}])}));
